<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="site-title-meta">Mubarak Afolabi — Hire Me</title>
    <link href="css/style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/js-yaml-browser@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/contentLoader.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        /* Ensure all navbar icons are 32×32 */
        #site-navbar ul li img {
            width: 32px;
            height: 32px;
        }

        /* Make every nav link area clickable and show pointer */
        #site-navbar ul li a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: white;
            cursor: pointer;
        }
        /* Custom styling for the round photo container */
        .round-photo-container {
            width: 150px; /* Adjust size as needed */
            height: 150px; /* Adjust size as needed */
            border-radius: 50%;
            overflow: hidden;
            background-color: #333; /* Placeholder background */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem auto; /* Center it */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .round-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Style for the testimonial photo container */
        .testimonial-photo-container {
            width: 120px; /* Bigger size for testimonials */
            height: 120px; /* Bigger size for testimonials */
            border-radius: 50%;
            overflow: hidden;
            background-color: #555; /* Placeholder background */
            flex-shrink: 0; /* Prevent shrinking in flexbox */
            margin-right: 1.5rem;
        }
        .testimonial-photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Style for the quotes mark */
        .quote-mark {
            font-size: 4rem; /* Larger size */
            color: #CDEDA2; /* Your primary color */
            line-height: 0.5; /* Adjust line height to prevent too much space */
            margin-right: 0.5rem;
            vertical-align: middle;
            display: inline-block;
        }

        /* NEW CSS for Testimonial Card Stack Animation (similar to project-item) */
        .testimonial-card {
            position: sticky;
            top: 100px; /* Adjust this value to control where the cards 'stick' on scroll, below your navbar */
            z-index: 1; /* Ensures cards stack correctly */
            transition: opacity 0.3s ease-out; /* Smooth fade out */
            /* min-height below might be needed if cards are too short to cause a proper sticky scroll */
            /* min-height: calc(100vh - 150px); */ /* Adjust based on your content and desired stickiness */
        }

        #testimonials-list {
            display: flex;
            flex-direction: column;
            /* Adjust this gap to control initial spacing between cards */
            gap: 2rem;
            /* Important for positioning context of sticky children */
            position: relative;
        }

        /* Style to prevent body scrolling when testimonials are stacking */
        body.no-scroll {
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-primary-background-dark text-text-light min-h-screen flex flex-col">

    <nav id="site-navbar"
        class="navbar sticky top-0 w-full border border-black backdrop-blur bg-primary-background-dark bg-opacity-50 transform transition-transform duration-500 -translate-y-full z-50">
        <ul class="flex justify-around items-center py-4">
            <li>
                <a href="index.html" class="flex flex-col items-center">
                    <img src="assets/Vector.svg" alt="Home Icon">
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="about.html" class="flex flex-col items-center">
                    <img src="assets/About Icon.svg" alt="About Icon">
                    <span>ABOUT</span>
                </a>
            </li>
            <li>
                <a href="projects.html" class="flex flex-col items-center">
                    <img src="assets/Projects Icon.svg" alt="Projects Icon">
                    <span>PROJECTS</span>
                </a>
            </li>
            <li>
                <a href="articles.html" class="flex flex-col items-center">
                    <img src="assets/Articles Icon.svg" alt="Articles Icon">
                    <span>ARTICLES</span>
                </a>
            </li>
            <li>
                <a href="hireMe.html" class="flex flex-col items-center">
                    <img src="assets/HireMe Icon.svg" alt="Hire Me Icon">
                    <span>HIRE ME</span>
                </a>
            </li>
            
            <li id="dark-toggle" class="flex flex-col items-center cursor-pointer">
                <img src="assets/ToggleOff Icon.svg" alt="Toggle Dark Mode" id="dark-toggle-icon">
                <span>dark mode</span>
            </li>
        </ul>
    </nav>

    <main class="flex-1 py-10 px-4 container mx-auto max-w-4xl">
        <h1 id="hire-me-title" class="text-xl font-bold pt-6 text-center mb-8"></h1>

        <div id="hire-me-photo-container" class="round-photo-container mb-12">
            <img src="https://via.placeholder.com/150/0000FF/FFFFFF?text=Your+Photo" alt="Mubarak Afolabi">
        </div>

        <p id="hire-me-tagline" class="text-center text-primary text-2xl font-bold mb-12"></p>

        <section class="mb-12">
            <div id="hire-me-introduction" class="text-white text-lg leading-relaxed text-center">
                </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-4 mt-4 text-white">What I Can Help You Achieve</h2>
            <div id="hire-me-what-i-do" class="list-disc list-inside text-white text-lg space-y-2 pl-4">
                </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-4 mt-4 text-white">Why Work With Me</h2>
            <div id="hire-me-why-work-with-me" class="text-white text-lg leading-relaxed pl-4">
                </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-4 mt-4 text-white">When You Reach Out, Please Include:</h2>
            <div id="hire-me-reach-out-guide" class="list-disc list-inside text-white text-lg space-y-2 pl-4">
                </div>
        </section>

        <section class="mb-12 mt-4" id="testimonials-main">
            <h2 class="text-3xl font-bold mb-4 text-white">Testimonials</h2>
            <div id="testimonials-list">
                </div>
        </section>

        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-4 mt-6 text-white">Get In Touch</h2>
            <p id="hire-me-call-to-action" class="text-center text-primary text-2xl font-bold mb-8 hover:text-text-light transition-colors duration-300">
                </p>

            <form action="#" method="POST" class="space-y-6">
                <div class="w-1/2">
                    <label for="email" class="text-white text-lg block mb-2">Email:</label>
                    <input type="email" id="email" name="email" placeholder="enter your email"
                           class="w-full p-3 rounded-lg bg-secondary-background-dark text-white placeholder-text-muted border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary h-10">
                </div>

                <div>
                    <label for="message" class="sr-only">Your Message</label>
                    <textarea id="message" name="message" placeholder="type your message here"
                                 class="w-full p-3 rounded-lg bg-secondary-background-dark text-white placeholder-text-muted border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"
                                 rows="5" style="height: 120px;"> </textarea>
                </div>

                <button type="submit" class="btn-primary flex items-center justify-center">
                    SEND
                    <img src="assets/Send Icon.svg" alt="Send Icon" class="ml-2 w-5 h-5 text-text-muted">
                </button>
            </form>
        </section>

    </main>

    <footer class="text-center text-text-muted bg-primary-background-dark py-4 z-40 mt-auto">
        <span id="footer-text">
            </span>
    </footer>

    <script>
        // === Navbar show/hide ===
        const nav = document.getElementById('site-navbar');
        let hideTimer;

        function showNavbar() {
            nav.classList.remove('-translate-y-full');
            clearTimeout(hideTimer);
            hideTimer = setTimeout(() => nav.classList.add('-translate-y-full'), 2500);
        }
        window.addEventListener('scroll', showNavbar);
        document.addEventListener('DOMContentLoaded', showNavbar);
        nav.addEventListener('mouseenter', showNavbar);
        nav.addEventListener('mouseleave', showNavbar);
        window.addEventListener('mousemove', e => {
            if (e.clientY < 50) showNavbar();
        });

        // === Dark mode toggle ===
        const toggleLi = document.getElementById('dark-toggle');
        const toggleIcon = document.getElementById('dark-toggle-icon');
        toggleLi.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            toggleIcon.src = isDark ? 'assets/ToggleOn Icon.svg' : 'assets/ToggleOff Icon.svg';
        });
        if (document.documentElement.classList.contains('dark')) toggleIcon.src = 'assets/ToggleOn Icon.svg';

        // === Load content and Testimonial Card Stack Scroll Animation ===
        document.addEventListener('DOMContentLoaded', async () => {
            const siteTitleMeta = document.getElementById('site-title-meta');
            const headerProfilePhoto = document.getElementById('profile-photo-header');
            const footerTextSpan = document.getElementById('footer-text');

            const hireMeTitle = document.getElementById('hire-me-title');
            const hireMePhotoContainer = document.getElementById('hire-me-photo-container');
            const hireMeTagline = document.getElementById('hire-me-tagline');
            const hireMeIntroduction = document.getElementById('hire-me-introduction');
            const hireMeWhatIDo = document.getElementById('hire-me-what-i-do');
            const hireMeWhyWorkWithMe = document.getElementById('hire-me-why-work-with-me');
            const hireMeReachOutGuide = document.getElementById('hire-me-reach-out-guide');
            const testimonialsList = document.getElementById('testimonials-list');
            const hireMeCallToAction = document.getElementById('hire-me-call-to-action');


            try {
                const siteSettings = await loadSiteSettings();
                if (siteTitleMeta) {
                    siteTitleMeta.textContent = siteSettings.siteTitle ? `${siteSettings.siteTitle} — Hire Me` : 'Mubarak Afolabi — Hire Me';
                }
                if (headerProfilePhoto) {
                    headerProfilePhoto.src = siteSettings.profilePhotoHeader || 'assets/profile.jpg';
                }
                if (footerTextSpan) {
                    footerTextSpan.textContent = siteSettings.footerText || '© 2025 Mubarak Afolabi. All rights reserved.';
                }

                const hireMeContent = await loadHireMeContent();

                if (hireMeContent) {
                    hireMeTitle.textContent = hireMeContent.title || 'Hire Me';
                    if (hireMeContent.profile_photo) {
                        hireMePhotoContainer.innerHTML = `<img src="${hireMeContent.profile_photo}" alt="Mubarak Afolabi">`;
                    } else {
                        hireMePhotoContainer.innerHTML = `<img src="https://via.placeholder.com/150/0000FF/FFFFFF?text=Your+Photo" alt="Placeholder Photo">`;
                    }
                    hireMeTagline.textContent = hireMeContent.tagline || "Let's Build Something Amazing Together";
                    hireMeIntroduction.innerHTML = marked.parse(hireMeContent.introduction || '<h3>Introduction content missing.</h3>');
                    hireMeWhatIDo.innerHTML = marked.parse(hireMeContent.what_i_can_do || '<h3>What I can do content missing.</h3>');
                    hireMeWhyWorkWithMe.innerHTML = marked.parse(hireMeContent.why_work_with_me || '<h3>Why work with me content missing.</h3>');
                    hireMeReachOutGuide.innerHTML = marked.parse(hireMeContent.reach_out_guide || '<h3>Reach out guide content missing.</h3>');
                    hireMeCallToAction.innerHTML = marked.parse(hireMeContent.call_to_action || '<h3>Call to action content missing.</h3>');


                    // Dynamically load testimonials
                    testimonialsList.innerHTML = ''; // Clear existing dummy testimonials
                    if (hireMeContent.testimonials && hireMeContent.testimonials.length > 0) {
                        hireMeContent.testimonials.forEach(testimonial => {
                            const testimonialCard = document.createElement('div');
                            testimonialCard.className = 'testimonial-card flex items-start bg-secondary-background-dark p-6 rounded-lg shadow-lg';
                            testimonialCard.innerHTML = `
                                <div class="testimonial-photo-container">
                                    <img src="${testimonial.photo || 'https://via.placeholder.com/120/CCCCCC/888888?text=Photo'}" alt="${testimonial.name}">
                                </div>
                                <div class="flex-1">
                                    <p class="text-white text-xl font-semibold leading-tight">${testimonial.name}</p>
                                    <p class="text-primary text-base mb-2">${testimonial.title_company}</p>
                                    <p class="text-white text-lg italic">
                                        <span class="quote-mark">“</span>${testimonial.quote}<span class="quote-mark">”</span>
                                    </p>
                                    ${testimonial.contact_email ? `<p class="text-white text-sm mt-4">Ask Me About Mubarak</p><a href="mailto:${testimonial.contact_email}" class="text-[#5f6368] text-sm hover:underline hover:text-primary transition-colors duration-300">${testimonial.contact_email}</a>` : ''}
                                </div>
                            `;
                            testimonialsList.appendChild(testimonialCard);
                        });
                    } else {
                        testimonialsList.innerHTML = '<p class="text-center text-text-muted">No testimonials available yet.</p>';
                    }

                    // Re-run testimonial animation logic after content is loaded
                    initTestimonialStackAnimation();

                } else {
                    hireMeTitle.textContent = "Content Not Found";
                    hireMeIntroduction.innerHTML = `<p class="text-center text-lg text-red-500">Could not load 'Hire Me' content.</p>`;
                }
            } catch (error) {
                console.error("Failed to load 'Hire Me' content or site settings:", error);
                hireMeTitle.textContent = "Error Loading Content";
                hireMeIntroduction.innerHTML = `<p class="text-center text-lg text-red-500">There was an error loading the page content. Please try again later.</p>`;
            }
        });

        // Testimonial Card Stack Animation Logic (moved into a function for reusability)
        function initTestimonialStackAnimation() {
            const testimonialsMain = document.getElementById('testimonials-main');
            const testimonialsList = document.getElementById('testimonials-list');
            const testimonialCards = testimonialsList.querySelectorAll('.testimonial-card');
            const body = document.body;

            if (testimonialCards.length === 0) {
                body.style.paddingBottom = '0'; // Ensure no extra padding if no cards
                return;
            }

            let testimonialsListTop;
            let totalStackingHeight = 0;
            let firstCardHeight = 0;
            let cardGap = 0;
            const stickyOffset = 100; // Must match 'top' value in .testimonial-card CSS

            const resizeObserver = new ResizeObserver(entries => {
                calculateStackingMetrics();
                onScroll();
            });

            function calculateStackingMetrics() {
                if (testimonialCards.length === 0) return;

                testimonialsListTop = testimonialsList.getBoundingClientRect().top + window.scrollY;

                const computedStyle = window.getComputedStyle(testimonialsList);
                cardGap = parseFloat(computedStyle.getPropertyValue('gap'));
                if (isNaN(cardGap)) {
                    cardGap = 0;
                    console.warn("Could not determine CSS gap for #testimonials-list. Stacking height might be inaccurate.");
                }

                firstCardHeight = testimonialCards[0].offsetHeight;
                
                const viewportHeight = window.innerHeight;
                totalStackingHeight = (testimonialCards.length - 1) * (firstCardHeight - stickyOffset + cardGap) + (viewportHeight * 0.5); // Adjusted to ensure enough scroll
                
                body.style.paddingBottom = `${totalStackingHeight}px`;

                testimonialCards.forEach(item => {
                    resizeObserver.observe(item);
                });

                onScroll(); // Call onScroll after metrics are recalculated
            }

            function onScroll() {
                const scrollY = window.scrollY;

                const animationZoneStart = testimonialsListTop - stickyOffset;
                const animationZoneEnd = animationZoneStart + totalStackingHeight - (window.innerHeight - stickyOffset);

                if (scrollY >= animationZoneStart && scrollY < animationZoneEnd) {
                    // This creates a smooth virtual scroll within the sticky area.
                    // Instead of preventing scroll, we'll let the user scroll and adjust card positions visually.
                    // This approach generally works better with sticky positioning.
                } else if (scrollY >= animationZoneEnd) {
                    body.classList.remove('no-scroll');
                    body.style.paddingBottom = '0'; // Ensure padding is reset when out of the animation zone
                } else if (scrollY < animationZoneStart) {
                    body.classList.remove('no-scroll');
                    body.style.paddingBottom = `${totalStackingHeight}px`;
                }

                testimonialCards.forEach((currentItem, index) => {
                    currentItem.style.zIndex = index + 1;

                    const cardTopRelativeToViewport = currentItem.getBoundingClientRect().top;
                    
                    // Determine how much of the card has been "covered" by the sticky top
                    // A card starts fading out when its top aligns with the stickyOffset (100px)
                    // The fade out finishes as the next card fully covers it.
                    const startFadeOffset = stickyOffset;
                    const fadeEndOffset = stickyOffset + (currentItem.offsetHeight * 0.7); // Fade over 70% of its height

                    if (cardTopRelativeToViewport <= startFadeOffset) {
                        const fadeProgress = clamp((startFadeOffset - cardTopRelativeToViewport) / (fadeEndOffset - startFadeOffset), 0, 1);
                        currentItem.style.opacity = `${1 - fadeProgress}`;
                        if (fadeProgress >= 1) {
                            currentItem.style.pointerEvents = 'none';
                        } else {
                            currentItem.style.pointerEvents = 'auto';
                        }
                    } else {
                        currentItem.style.opacity = 1;
                        currentItem.style.pointerEvents = 'auto';
                    }
                });

                // Ensure the very last card remains visible and opaque if it's the last one in the stack
                if (scrollY >= animationZoneEnd && testimonialCards.length > 0) {
                    const lastCard = testimonialCards[testimonialCards.length - 1];
                    lastCard.style.opacity = 1;
                    lastCard.style.pointerEvents = 'auto';
                }
            }

            function clamp(x, min, max) {
                return Math.min(Math.max(x, min), max);
            }

            // Initial setup on DOMContentLoaded
            setTimeout(() => {
                calculateStackingMetrics();
            }, 200);

            window.addEventListener('resize', () => {
                calculateStackingMetrics();
            });

            window.addEventListener('scroll', onScroll);
        }
        
        // Initial call when the page loads
        // initTestimonialStackAnimation is now called from the main DOMContentLoaded block
    </script>
</body>
</html>